<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>リアルタイム音声認識</title>
  <style>
    #transcript {
      margin-top: 20px;
      font-size: 18px;
      white-space: pre-wrap;
    }
    .speakerButton {
      margin-right: 10px;
    }
  </style>
</head>
<body>
  <h1>リアルタイム音声認識</h1>
  <button id="startButton" onclick="startSpeechRecognition()">音声認識開始</button>
  <button id="stopButton" onclick="stopSpeechRecognition()" style="display: none;">音声認識停止</button>
  <button class="speakerButton" onclick="setSpeaker('話者 1')">話者 1</button>
  <button class="speakerButton" onclick="setSpeaker('話者 2')">話者 2</button>
  <button class="speakerButton" onclick="setSpeaker('話者 3')">話者 3</button>
  <button class="speakerButton" onclick="setSpeaker('話者 4')">話者 4</button>
　<button class="speakerButton" onclick="setSpeaker('話者 5')">話者 5</button>
  <button class="speakerButton" onclick="setSpeaker('話者 6')">話者 6</button>
  <button class="speakerButton" onclick="setSpeaker('話者 7')">話者 7</button>
  <button class="speakerButton" onclick="setSpeaker('話者 8')">話者 8</button>
  <button class="speakerButton" onclick="setSpeaker('話者 9')">話者 9</button>
  <button class="speakerButton" onclick="setSpeaker('話者 10')">話者 10</button>
  <div id="transcript"></div>

  <script>
    let recognition = null;
    const transcriptDiv = document.getElementById('transcript');
    let transcript = '';
    let recognizing = false;
    let prevResultIndex = 0;
    let currentSpeaker = '';

    function setSpeaker(speaker) {
      currentSpeaker = speaker;
      transcript += `\n${currentSpeaker}: `;
      transcriptDiv.textContent = transcript;
    }

    function startSpeechRecognition() {
      if (!recognition) {
        if ('webkitSpeechRecognition' in window) {
          recognition = new webkitSpeechRecognition(); // Chrome, Safari向けの実装
        } else if ('SpeechRecognition' in window) {
          recognition = new SpeechRecognition(); // Edge, Firefox向けの実装
        } else {
          alert('このブラウザは音声認識をサポートしていません。');
          return;
        }

        recognition.lang = 'ja-JP'; // 認識言語を日本語に設定
        recognition.continuous = true; // 連続認識を有効にする設定
        recognition.interimResults = true; // 途中結果を有効にする設定

        recognition.onresult = function(event) {
          let interimTranscript = '';
          for (let i = prevResultIndex; i < event.results.length; i++) {
            if (event.results[i].isFinal) {
              transcript += event.results[i][0].transcript + ' ';
            } else {
              interimTranscript += event.results[i][0].transcript;
            }
          }
          transcriptDiv.textContent = transcript + interimTranscript;
          prevResultIndex = event.resultIndex + event.results.length;
        };

        recognition.onend = function() {
          if (recognizing) {
            recognition.start(); // 認識が終了したら再度開始
          }
        };
      }

      recognizing = true;
      prevResultIndex = 0;
      recognition.start(); // 音声認識の開始

      // ボタンの表示切り替え
      document.getElementById('startButton').style.display = 'none';
      document.getElementById('stopButton').style.display = 'inline';
    }

    function stopSpeechRecognition() {
      if (recognition) {
        recognizing = false;
        recognition.stop(); // 音声認識の停止

        // ボタンの表示切り替え
        document.getElementById('startButton').style.display = 'inline';
        document.getElementById('stopButton').style.display = 'none';
      }
    }

  </script>
</body>
</html>
